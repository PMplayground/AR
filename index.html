<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR PNG Sequence Animation (Auto Detect frame_0001 format)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>

  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-assets id="assets"></a-assets>

      <a-marker preset="hiro">
        <a-plane id="animPlane"
          position="0 0 0"
          rotation="-90 0 0"
          width="1"
          height="1"
          material="transparent: true;"
        ></a-plane>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const assetsEl = document.getElementById("assets");
      const plane = document.getElementById("animPlane");

      // Adjust for your filename format (frame_0001.png, frame_0002.png, etc.)
      let frameIndex = 1;
      const framePaths = [];

      async function checkFrames() {
        while (true) {
          const frameNumber = String(frameIndex).padStart(4, "0"); // ensures 0001, 0002, etc.
          const path = `assets/frame_${frameNumber}.png`;
          try {
            const res = await fetch(path, { method: 'HEAD' });
            if (!res.ok) break;
            framePaths.push(path);
            frameIndex++;
          } catch {
            break;
          }
        }

        if (framePaths.length === 0) {
          console.error("❌ No frames found in /assets/ named frame_0001.png, frame_0002.png...");
          return;
        }

        // Preload images
        framePaths.forEach((path, i) => {
          const img = document.createElement("img");
          img.setAttribute("id", `frame${i+1}`);
          img.setAttribute("src", path);
          assetsEl.appendChild(img);
        });

        // Start animation
        animateFrames();
      }

      function animateFrames() {
        let currentFrame = 0;
        const frameDelay = 100; // ms per frame — adjust for speed
        const totalFrames = framePaths.length;

        setInterval(() => {
          currentFrame = (currentFrame + 1) % totalFrames;
          const srcId = `#frame${currentFrame + 1}`;
          plane.setAttribute("material", "src", srcId);
        }, frameDelay);
      }

      checkFrames();
    </script>
  </body>
</html>
