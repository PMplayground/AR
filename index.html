<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR PNG Sequence Animation</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      .loading { 
        position: absolute; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%); 
        color: white; 
        background: rgba(0,0,0,0.8);
        padding: 20px;
        border-radius: 10px;
        z-index: 1000; 
        font-family: Arial; 
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading">Loading AR experience...</div>
    
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-assets id="assets">
        <!-- Assets will be added here -->
      </a-assets>

      <a-marker preset="hiro">
        <a-plane
          id="animPlane"
          position="0 0.5 0"
          rotation="0 0.5 0"
          width="3"
          height="6"
          material="src: #defaultFrame; transparent: true; alphaTest: 0.5; opacity: 1;"
        ></a-plane>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const loadingEl = document.getElementById('loading');
      const assetsEl = document.getElementById('assets');
      const plane = document.getElementById('animPlane');

      const TOTAL_FRAMES = 120; // Change to your frame count
      let framePaths = [];
      let currentFrame = 0;

      function initializeAnimation() {
        loadingEl.textContent = 'Setting up animation...';
        
        framePaths = [];
        for (let i = 1; i <= TOTAL_FRAMES; i++) {
          const frameNumber = String(i).padStart(4, "0");
          framePaths.push(`assets/frame_${frameNumber}.png`);
        }
        
        preloadFrames();
      }

      function preloadFrames() {
        loadingEl.textContent = `Preloading ${framePaths.length} frames...`;
        
        let loadedCount = 0;

        framePaths.forEach((path, index) => {
          const img = new Image();
          img.onload = function() {
            loadedCount++;
            loadingEl.textContent = `Loading frames... ${loadedCount}/${framePaths.length}`;
            
            const imgEl = document.createElement('img');
            imgEl.setAttribute('id', `frame${index + 1}`);
            imgEl.setAttribute('src', path);
            assetsEl.appendChild(imgEl);

            if (loadedCount === framePaths.length) {
              loadingEl.style.display = 'none';
              startAnimation();
            }
          };
          
          img.onerror = function() {
            console.error(`Failed to load: ${path}`);
            loadedCount++;
            if (loadedCount === framePaths.length) {
              loadingEl.style.display = 'none';
              startAnimation();
            }
          };
          
          img.src = path;
        });
      }

      function startAnimation() {
        console.log('Starting animation with transparency fix');
        
        const fps = 30;
        const frameDelay = 1000 / fps;

        const animationInterval = setInterval(() => {
          currentFrame = (currentFrame + 1) % framePaths.length;
          const srcId = `#frame${currentFrame + 1}`;
          
          // CRITICAL: Set all material properties for transparency
          plane.setAttribute('material', {
            src: srcId,
            transparent: true,
            alphaTest: 0.05, // Adjust this value (0.1 to 0.5)
            opacity: 1,
            side: 'double'     // Render both sides
          });
          
        }, frameDelay);

        plane.animationInterval = animationInterval;
      }

      // Start when scene loads
      document.querySelector('a-scene').addEventListener('loaded', function() {
        initializeAnimation();
      });
    </script>
  </body>
</html>






